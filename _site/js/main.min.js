var $likes=$("#likes"),$count=$likes.find("span.count"),$pageId=$likes.data("page-id"),hasLikes=!1,database="nathanstaines",collection="likes",apiKey="5023a018e4b07b766e03f324";if($likes.length){if(localStorage&&localStorage.getItem($pageId)){var data=JSON.parse(localStorage.getItem($pageId));data.counted&&$likes.addClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full")}if(sessionStorage&&sessionStorage.getItem($pageId)){var data=JSON.parse(sessionStorage.getItem($pageId));$count.text(data.count)}else $.ajax({url:"https://api.mongolab.com/api/1/databases/"+database+"/collections/"+collection+"?apiKey="+apiKey,type:"GET",contentType:"application/json",success:function(e){$.each(e,function(e,t){if(t.pageId===$pageId){$count.text(t.count);hasLikes=!0}sessionStorage.setItem(t.pageId,JSON.stringify({count:t.count}))});hasLikes||$.ajax({url:"https://api.mongolab.com/api/1/databases/"+database+"/collections/"+collection+"?apiKey="+apiKey,data:JSON.stringify({pageId:$pageId,count:0}),type:"POST",contentType:"application/json",success:function(){sessionStorage.setItem($pageId,JSON.stringify({count:0}))}})}});$likes.on("click",function(e){var t=$count.text(),n=$likes.hasClass("counted")?!1:!0;t=$likes.hasClass("counted")?t--:t++;$likes.toggleClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full");$count.text(t);sessionStorage.setItem($pageId,JSON.stringify({count:t}));localStorage.setItem($pageId,JSON.stringify({counted:n}));$.ajax({url:"https://api.mongolab.com/api/1/databases/"+database+"/runCommand?apiKey="+apiKey,data:JSON.stringify({findAndModify:collection,query:{pageId:$pageId},update:{$inc:{count:$likes.hasClass("counted")?1:-1}},upsert:!0}),type:"POST",contentType:"application/json"});e.preventDefault()})};