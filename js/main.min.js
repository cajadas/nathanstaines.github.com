(function(){"use strict";var e=$("#likes"),t=e.find("span.count"),n=e.data("page-id"),r=!1,i="nathanstaines",s="likes",o="5023a018e4b07b766e03f324";if(e.length){if(localStorage&&localStorage.getItem(n)){var u=JSON.parse(localStorage.getItem(n));u.counted&&e.addClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full")}if(sessionStorage&&sessionStorage.getItem(n)){var a=JSON.parse(sessionStorage.getItem(n));t.text(a.count)}else $.ajax({url:"https://api.mongolab.com/api/1/databases/"+i+"/collections/"+s+"?apiKey="+o,type:"GET",contentType:"application/json",success:function(e){$.each(e,function(e,i){if(i.pageId===n){t.text(i.count);r=!0}sessionStorage.setItem(i.pageId,JSON.stringify({count:i.count}))});r||$.ajax({url:"https://api.mongolab.com/api/1/databases/"+i+"/collections/"+s+"?apiKey="+o,data:JSON.stringify({pageId:n,count:0}),type:"POST",contentType:"application/json",success:function(){t.text("0");sessionStorage.setItem(n,JSON.stringify({count:0}))}})}});e.on("click",function(e){var r=$(this),u=t.text();r.toggleClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full");u=r.hasClass("counted")?++u:--u;t.text(u);sessionStorage.setItem(n,JSON.stringify({count:u}));localStorage.setItem(n,JSON.stringify({counted:r.hasClass("counted")?!0:!1}));$.ajax({url:"https://api.mongolab.com/api/1/databases/"+i+"/runCommand?apiKey="+o,data:JSON.stringify({findAndModify:s,query:{pageId:n},update:{$inc:{count:r.hasClass("counted")?1:-1}},upsert:!0}),type:"POST",contentType:"application/json"});e.preventDefault()})}})();